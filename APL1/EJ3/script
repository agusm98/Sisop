#! /bin/bash

CAN_PUSH=false

while getopts ":c:a:s:" param; do
    case $param in
		c)
			c=$OPTARG;; #Directorio a monitorear cambios
			#func Monitorear(c);;
		a)
			a=$OPTARG;;
        s)
            s=$OPTARG;;
		*)
			echo "$param not valid";;
	esac
done

actionHandler() {

    IFS=','
    for action in $a; do
        case $action in
            listar)
                listar $c;;
            peso)
                peso $c;;
            compilar)
                compilar $c;;
            publicar)
                publicar $s;;
            *)
                echo "$action invalida";;
        esac
    done
}

listar() {
    find $1 -type -f -name '*.txt'
}

peso() { echo "peso call $1"; }

compilar() {
    #if file exist remove
    if [[ -e ./bin/output.txt ]]; then
        rm ./bin/output.txt
    fi
    #create output file
    mkdir -p ./bin
    touch ./bin/output.txt
    
    find $1 -type f -name '*.txt' -exec cat {} + >> './bin/output.txt';
    CAN_PUSH=true #TODO: Usar pipe en vez de booleano
}

publicar() {
    if [[ CAN_PUSH ]]; then
        cp ./bin/output.txt $1
    fi
}
echo "Parametros $c $a $s";
actionHandler
